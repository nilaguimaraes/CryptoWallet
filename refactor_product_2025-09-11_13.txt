Refactor product search for query (major)
